<style>
  .btn-search {
    background-color: #101010;
    color: white;
    border-radius: 1rem;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    padding:0 1rem 0 1rem;
  }
  .btn-search:hover {
    background-color: #0a0a0a;
    color: grey;
  }
  .btn-search i{
    display: inline;
    margin-right: 0.5rem;

  }
  .search-input{
    border-radius: 20px;
    padding:0.5rem 3rem 0.5rem 3rem;
    font-size: 1rem;
  }
  .search-container {
    position: relative;
    width: 100%;
  }
  .suggestions-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 0 20px 20px;
    max-height: 300px;
    overflow-y: auto;
    display: none;
    z-index: 1000;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  .suggestions-dropdown.show {
    display: block;
  }
  .suggestion-item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
  }
  .suggestion-item:hover {
    background-color: #f5f5f5;
  }
  .suggestion-item:last-child {
    border-bottom: none;
  }
</style>

<nav class="navbar navbar-expand-md bg-body-light border-bottom sticky-top">
  <div class="container-fluid bg-body-light sticky-top">
    <a class="navbar-brand" href="/listings"><b>Stazy</b></a>
    <button class="navbar-toggler bg-body-light" type="button" data-bs-toggle="collapse"
      data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse bg-body-light" id="navbarNavAltMarkup"
      style=" background-color:white; backdrop-filter: blur(1px); border-radius: 10px; margin-top: 5px; padding-left: 10px;">
      <div class="navbar-nav ">
        &nbsp; &nbsp; &nbsp;
      </div>
      <div class="navbar-nav ms-auto">
        <form class="d-flex" role="search" action="/listings/search" method="GET" style="position: relative;">
          <div class="search-container" style="width: 100%;">
            <input 
              class="form-control me-2 search-input" 
              type="search" 
              id="searchInput"
              name="q" 
              placeholder="Search destinations" 
              aria-label="Search" 
              autocomplete="off"
            />
            <div class="suggestions-dropdown" id="suggestionsDropdown"></div>
          </div>
          <button class="btn btn-search" type="submit"><i class="fa-solid fa-magnifying-glass"></i>Search</button>
        </form>
      </div>
      <div class="navbar-nav ms-auto ">
        <a class="nav-link" href="/listings/new"><b>Add Your's </b></a>
        <% if (typeof currUser === 'undefined' || !currUser) { %>
          <a class="nav-link" href="/signup"><b><i>Sign up</i></b></a>
          <a class="nav-link" href="/login"><b><i>Log in</i></b></a>
        <% } %>
        <% if (typeof currUser !== 'undefined' && currUser) { %>
          <a class="nav-link" href="/logout"><b><i>Log out</i></b></a>
        <% } %>
      </div>
    </div>
  </div>
</nav>

<script>
  const searchInput = document.getElementById('searchInput');
  const suggestionsDropdown = document.getElementById('suggestionsDropdown');
  let debounceTimer;

  searchInput.addEventListener('input', function() {
    clearTimeout(debounceTimer);
    const query = this.value.trim();
    
    if (query.length < 1) {
      suggestionsDropdown.classList.remove('show');
      suggestionsDropdown.innerHTML = '';
      return;
    }
    
    debounceTimer = setTimeout(() => {
      fetch(`/listings/suggestions?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(suggestions => {
          if (suggestions.length > 0) {
            suggestionsDropdown.innerHTML = suggestions
              .map(suggestion => `
                <div class="suggestion-item" onclick="selectSuggestion('${suggestion.replace(/'/g, "\\'")}')">
                  <i class="fa-solid fa-map-pin" style="margin-right: 8px; color: #666;"></i>${suggestion}
                </div>
              `)
              .join('');
            suggestionsDropdown.classList.add('show');
          } else {
            suggestionsDropdown.classList.remove('show');
            suggestionsDropdown.innerHTML = '';
          }
        })
        .catch(error => console.error('Error fetching suggestions:', error));
    }, 300);
  });

  searchInput.addEventListener('blur', function() {
    setTimeout(() => {
      suggestionsDropdown.classList.remove('show');
    }, 200);
  });

  function selectSuggestion(suggestion) {
    searchInput.value = suggestion;
    suggestionsDropdown.classList.remove('show');
  }
</script>